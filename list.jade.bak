extends layout

block content
  h2 #{title}
  table.table.table-hover
    caption #{message}
    thead
     tr
      th(scope='col') #
      th(scope='col')
        input#selecthead(type='checkbox', name='shead')  
        button#btninstall.btn.btn-xs.btn-default(data-whatever='ALL', disabled) Install
        //button#btninstall.btn.btn-xs.btn-default(data-toggle='modal', data-target='#installerModal', disabled) Install
      th(scope='col') Agent ID
      th(scope='col') ホスト名
      th(scope='col') 稼働状態
      th(scope='col') 操作ログ
      th(scope='col') 配信状況
      th(scope='col') 配信履歴
      th(scope='col') コメント
    tbody#bodyList
      tr.bg-warning
       th(scope='row') 1
       td: input.chkhost(type='checkbox',name='checkhost[]',value='01',disabled)
       td Agent001
       td ホスト1
       td 
         button.btn.btn-xs.btn-warning(data-toggle='modal', data-target='#installerModal') BUSY  
       td 
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-list-alt(aria-hidden='true')  
           a(href='/opllog/agent01')  ログ 
       td 
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-tasks(aria-hidden='true') 
           span  状態 
           span.badge 2 
       td
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-transfer(aria-hidden='true')
           a(href='/sendlog/agent01')  履歴 
       td 
      tr       
       th(scope='row') 2
       td: input.chkhost(type='checkbox',name='checkhost[]',value='02')
       td Agent002
       td ホスト2
       td   
         button.btn.btn-xs.btn-default(data-toggle='modal', data-target='#installerModal', data-whatever='Agent002') 未知  
       td 
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-list-alt(aria-hidden='true')  ログ 
       td 
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-tasks(aria-hidden='true')  状態 
       td 
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-transfer(aria-hidden='true')
           a(href='/sendlog') 履歴 
       td 
      tr.bg-danger
       th(scope='row') 3
       td: input.chkhost(type='checkbox',name='checkhost[]',value='03')
       td Agent003
       td ホスト3   
       td 
         button.btn.btn-xs.btn-danger(data-toggle='modal', data-target='#installerModal', data-whatever='Agent003') 未インストール  
       td
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-list-alt(aria-hidden='true')  ログ 
       td 
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-tasks(aria-hidden='true')  状態 
       td
         button.btn.btn-default.btn-xs.disabled(aria-label='Left Align')
           span.glyphicon.glyphicon-transfer(aria-hidden='true')
           a(href='/sendlog') 履歴 
       td 
      tr.bg-info
       th(scope='row') 4
       td: input.chkhost(type='checkbox',name='checkhost[]',value='04', disabled)
       td Agent004
       td ホスト3   
       td 
         button.btn.btn-xs.btn-success(data-toggle='modal', data-target='#installerModal') 稼働中   
       td 
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-list-alt(aria-hidden='true') 
           a(href='/opllog/agent01')  ログ 
       td 
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-tasks(aria-hidden='true') 
           span  状態 
           span.badge 15
       td
         button.btn.btn-default.btn-xs(aria-label='Left Align')
           span.glyphicon.glyphicon-transfer(aria-hidden='true')
           a(href='/sendlog/agent04')  履歴 
       td 
  include installdialog.jade
  script.
    $(function() {
       $('#selecthead').change(function() { 
         $('.chkhost').each(function() {
           if($(this).attr('disabled') == 'disabled') {
              $(this).prop('checked', false);
           } else {
              $(this).prop('checked', $('#selecthead').prop('checked'));
           }
         });
         var len = $('.chkhost:checked').length;
         if(len > 0) {
           $('#btninstall').prop('disabled', false);
         } else {
           $('#btninstall').prop('disabled', true);            
         }
       });
       
       $('#btninstall').click(function() {
         $('#installerModal').modal('show', $('.chkhost'));
       });

       $('.chkhost').change(function() {
         var len = $('.chkhost:checked').length;
         if(len > 0) {
           $('#btninstall').prop('disabled', false);
         } else {
           $('#btninstall').prop('disabled', true);
           $('#selecthead').prop('checked', false); 
         }
       });
       $('#installerModal').on('show.bs.modal', function(event) {
          var agentid = $(this).find('.modal-body p#agentid');
          var button =  $(event.relatedTarget);
          var whatever = button.data('whatever');
          if(whatever==null) {
            var len = button.length
            if(len>0 && button.prop('tagName')!= "BUTTON") {
              var agents = [];
              button.each(function() {
                if($(this).prop('checked') == true)
                  agents.push($(this).val());
              });
              agentid.text('選択したAgentID : '+ agents);
            } else {
              //agentid.text("null");
              event.preventDefault();
            }
          } else {
            agentid.text(whatever);
          }
       });
    });
